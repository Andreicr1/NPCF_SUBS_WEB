"use strict";(()=>{var e={};e.id=337,e.ids=[337],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9382:(e,s,r)=>{r.r(s),r.d(s,{originalPathname:()=>g,patchFetch:()=>h,requestAsyncStorage:()=>l,routeModule:()=>d,serverHooks:()=>f,staticGenerationAsyncStorage:()=>m});var t={};r.r(t),r.d(t,{GET:()=>c,POST:()=>p});var i=r(9303),a=r(8716),n=r(670),o=r(7070),u=r(2663);async function p(e){try{let{investorData:s,kycData:r}=await e.json();if(!s.cpfCnpj||!s.fullName||!s.email)return o.NextResponse.json({error:"Dados obrigat\xf3rios faltando"},{status:400});let t={...s,isPep:r.pep.isPep,pepDetails:r.pep.pepDetails,pepPosition:r.pep.pepPosition,pepCountry:r.pep.pepCountry,isRca:r.pep.isRca,rcaRelationship:r.pep.rcaRelationship,sourceOfFunds:r.source.sourceOfFunds,sourceOfWealth:r.source.sourceOfWealth,wealthCategories:JSON.stringify(r.source.wealthCategories),wealthDetails:r.source.wealthDetails,transferringBank:r.source.transferringBank,transferringBankCountry:r.source.transferringBankCountry,employerName:r.source.employerName,employerAddress:r.source.employerAddress,isUsCitizen:r.fatcaCrs.isUsCitizen,ustin:r.fatcaCrs.ustin,usBirthplace:r.fatcaCrs.usBirthplace,hasSurrenderedUsCitizenship:r.fatcaCrs.hasSurrenderedUsCitizenship,taxResidencies:JSON.stringify(r.fatcaCrs.taxResidencies),eligibleInvestorConfirmation:r.subscription.eligibleInvestorConfirmation,nonUsPersonConfirmation:r.subscription.nonUsPersonConfirmation,shareClassSelection:r.subscription.shareClassSelection,subscriptionAmountWords:r.subscription.subscriptionAmountWords,status:"submitted",submittedAt:new Date,updatedAt:new Date},i=await u.Z.investor.upsert({where:{cpfCnpj:s.cpfCnpj},create:t,update:t});return await u.Z.auditLog.create({data:{userId:i.id,action:"submit",entity:"investor",entityId:i.id,changes:JSON.stringify({investorData:s,kycData:r}),ipAddress:e.headers.get("x-forwarded-for")||e.headers.get("x-real-ip"),userAgent:e.headers.get("user-agent")}}),o.NextResponse.json({success:!0,investorId:i.id,investor:i})}catch(e){return console.error("Error submitting KYC:",e),o.NextResponse.json({error:e.message||"Erro ao submeter dados KYC"},{status:500})}}async function c(e){try{let s=e.nextUrl.searchParams.get("investorId");if(!s)return o.NextResponse.json({error:"investorId \xe9 obrigat\xf3rio"},{status:400});let r=await u.Z.investor.findUnique({where:{id:s},include:{documents:!0,signatures:!0}});if(!r)return o.NextResponse.json({error:"Investidor n\xe3o encontrado"},{status:404});let t={...r,wealthCategories:r.wealthCategories?JSON.parse(r.wealthCategories):[],taxResidencies:r.taxResidencies?JSON.parse(r.taxResidencies):[]};return o.NextResponse.json(t)}catch(e){return console.error("Error fetching KYC data:",e),o.NextResponse.json({error:e.message||"Erro ao buscar dados KYC"},{status:500})}}let d=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/kyc/submit/route",pathname:"/api/kyc/submit",filename:"route",bundlePath:"app/api/kyc/submit/route"},resolvedPagePath:"C:\\Users\\andre\\OneDrive\\Documentos\\Netz\\Subscriptions\\NPCF Subs WEB\\app\\api\\kyc\\submit\\route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:l,staticGenerationAsyncStorage:m,serverHooks:f}=d,g="/api/kyc/submit/route";function h(){return(0,n.patchFetch)({serverHooks:f,staticGenerationAsyncStorage:m})}},2663:(e,s,r)=>{r.d(s,{Z:()=>i});let t=require("@prisma/client"),i=global.prisma||new t.PrismaClient}};var s=require("../../../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),t=s.X(0,[789],()=>r(9382));module.exports=t})();