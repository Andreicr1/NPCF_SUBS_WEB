"use strict";(()=>{var e={};e.id=540,e.ids=[540],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},1505:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>m,patchFetch:()=>g,requestAsyncStorage:()=>d,routeModule:()=>c,serverHooks:()=>h,staticGenerationAsyncStorage:()=>f});var s={};r.r(s),r.d(s,{GET:()=>p,POST:()=>l});var n=r(9303),a=r(8716),i=r(670),o=r(7070),u=r(2663);async function p(e){try{let t=e.nextUrl.searchParams,r=t.get("email"),s=t.get("cpfCnpj"),n=t.get("status");if(r||s){let e=await u.Z.investor.findFirst({where:{...r&&{email:r},...s&&{cpfCnpj:s}},include:{documents:!0,signatures:!0}});if(!e)return o.NextResponse.json({error:"Investor not found"},{status:404});return o.NextResponse.json(e)}let a=await u.Z.investor.findMany({where:{...n&&{status:n}},include:{documents:{select:{id:!0,documentType:!0,status:!0}},signatures:{select:{id:!0,status:!0,signedAt:!0}}},orderBy:{createdAt:"desc"}});return o.NextResponse.json(a)}catch(e){return console.error("Error fetching investors:",e),o.NextResponse.json({error:"Failed to fetch investors",details:e.message},{status:500})}}async function l(e){try{let t=await e.json();if(!t.email)return o.NextResponse.json({error:"Email is required"},{status:400});if(!t.cpfCnpj)return o.NextResponse.json({error:"CPF/CNPJ is required"},{status:400});let r=t.cpfCnpj.replace(/[^\d]/g,"");if(11===r.length){if(!function(e){if(11!==(e=e.replace(/[^\d]/g,"")).length||/^(\d)\1+$/.test(e))return!1;let t=0;for(let r=0;r<9;r++)t+=parseInt(e.charAt(r))*(10-r);let r=11-t%11;if(r>=10&&(r=0),r!==parseInt(e.charAt(9)))return!1;t=0;for(let r=0;r<10;r++)t+=parseInt(e.charAt(r))*(11-r);return(r=11-t%11)>=10&&(r=0),r===parseInt(e.charAt(10))}(r))return o.NextResponse.json({error:"Invalid CPF"},{status:400})}else if(14!==r.length)return o.NextResponse.json({error:"CPF/CNPJ must be 11 or 14 digits"},{status:400});else if(!function(e){if(14!==(e=e.replace(/[^\d]/g,"")).length||/^(\d)\1+$/.test(e))return!1;let t=e.length-2,r=e.substring(0,t),s=e.substring(t),n=0,a=t-7;for(let e=t;e>=1;e--)n+=parseInt(r.charAt(t-e))*a--,a<2&&(a=9);let i=n%11<2?0:11-n%11;if(i!==parseInt(s.charAt(0)))return!1;t+=1,r=e.substring(0,t),n=0,a=t-7;for(let e=t;e>=1;e--)n+=parseInt(r.charAt(t-e))*a--,a<2&&(a=9);return(i=n%11<2?0:11-n%11)===parseInt(s.charAt(1))}(r))return o.NextResponse.json({error:"Invalid CNPJ"},{status:400});if(await u.Z.investor.findFirst({where:{OR:[{email:t.email},{cpfCnpj:t.cpfCnpj}]}}))return o.NextResponse.json({error:"Investor with this email or CPF/CNPJ already exists"},{status:409});let s=await u.Z.investor.create({data:{investorType:t.investorType||"individual",fullName:t.fullName,legalName:t.legalName,cpfCnpj:t.cpfCnpj,rg:t.rg,birthDate:t.birthDate?new Date(t.birthDate):null,nationality:t.nationality,maritalStatus:t.maritalStatus,profession:t.profession,address:t.address,addressNumber:t.addressNumber,complement:t.complement,neighborhood:t.neighborhood,city:t.city,state:t.state,zipCode:t.zipCode,country:t.country||"Brasil",email:t.email,phone:t.phone,cellphone:t.cellphone,isQualified:t.isQualified||!1,qualificationType:t.qualificationType,bankName:t.bankName,bankBranch:t.bankBranch,bankAccount:t.bankAccount,bankAccountType:t.bankAccountType,subscriptionAmount:t.subscriptionAmount,numberOfQuotas:t.numberOfQuotas,quotaValue:t.quotaValue,isPep:t.isPep||!1,pepDetails:t.pepDetails,status:"draft"}});return await u.Z.auditLog.create({data:{userId:s.id,action:"create",entity:"investor",entityId:s.id,changes:JSON.stringify({created:!0}),ipAddress:e.headers.get("x-forwarded-for")||"unknown",userAgent:e.headers.get("user-agent")||"unknown"}}),o.NextResponse.json(s,{status:201})}catch(e){return console.error("Error creating investor:",e),o.NextResponse.json({error:"Failed to create investor",details:e.message},{status:500})}}let c=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/investors/route",pathname:"/api/investors",filename:"route",bundlePath:"app/api/investors/route"},resolvedPagePath:"C:\\Users\\andre\\OneDrive\\Documentos\\Netz\\Subscriptions\\NPCF Subs WEB\\app\\api\\investors\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:d,staticGenerationAsyncStorage:f,serverHooks:h}=c,m="/api/investors/route";function g(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:f})}},2663:(e,t,r)=>{r.d(t,{Z:()=>n});let s=require("@prisma/client"),n=global.prisma||new s.PrismaClient}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[789],()=>r(1505));module.exports=s})();