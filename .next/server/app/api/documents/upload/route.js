"use strict";(()=>{var e={};e.id=62,e.ids=[62],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5315:e=>{e.exports=require("path")},6762:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>y,patchFetch:()=>v,requestAsyncStorage:()=>h,routeModule:()=>f,serverHooks:()=>w,staticGenerationAsyncStorage:()=>x});var o={};r.r(o),r.d(o,{DELETE:()=>g,GET:()=>m,POST:()=>l});var s=r(9303),a=r(8716),n=r(670),i=r(7070);let u=require("fs/promises"),d=require("fs");var c=r(5315),p=r(2663);async function l(e){try{let t=await e.formData(),r=t.get("file"),o=t.get("documentType"),s=t.get("investorId");if(!r||!o||!s)return i.NextResponse.json({error:"Arquivo, tipo de documento e investorId s\xe3o obrigat\xf3rios"},{status:400});if(!await p.Z.investor.findUnique({where:{id:s}}))return i.NextResponse.json({error:"Investidor n\xe3o encontrado"},{status:404});let a=(0,c.join)(process.cwd(),"uploads",s);(0,d.existsSync)(a)||await (0,u.mkdir)(a,{recursive:!0});let n=Date.now(),l=r.name.replace(/[^a-zA-Z0-9.-]/g,"_"),m=`${o}_${n}_${l}`,g=(0,c.join)(a,m),f=await r.arrayBuffer(),h=Buffer.from(f);await (0,u.writeFile)(g,h);let x=await p.Z.document.create({data:{investorId:s,documentType:o,fileName:m,filePath:`/uploads/${s}/${m}`,fileSize:r.size,mimeType:r.type,status:"pending"}});return await p.Z.auditLog.create({data:{userId:s,action:"upload",entity:"document",entityId:x.id,changes:JSON.stringify({documentType:o,fileName:m,fileSize:r.size}),ipAddress:e.headers.get("x-forwarded-for")||e.headers.get("x-real-ip"),userAgent:e.headers.get("user-agent")}}),i.NextResponse.json(x)}catch(e){return console.error("Error uploading document:",e),i.NextResponse.json({error:e.message||"Erro ao fazer upload do documento"},{status:500})}}async function m(e){try{let t=e.nextUrl.searchParams.get("investorId");if(!t)return i.NextResponse.json({error:"investorId \xe9 obrigat\xf3rio"},{status:400});let r=await p.Z.document.findMany({where:{investorId:t},orderBy:{createdAt:"desc"}});return i.NextResponse.json(r)}catch(e){return console.error("Error fetching documents:",e),i.NextResponse.json({error:e.message||"Erro ao buscar documentos"},{status:500})}}async function g(e){try{let t=e.nextUrl.searchParams.get("documentId");if(!t)return i.NextResponse.json({error:"documentId \xe9 obrigat\xf3rio"},{status:400});let r=await p.Z.document.findUnique({where:{id:t}});if(!r)return i.NextResponse.json({error:"Documento n\xe3o encontrado"},{status:404});return await p.Z.document.delete({where:{id:t}}),await p.Z.auditLog.create({data:{userId:r.investorId,action:"delete",entity:"document",entityId:t,changes:JSON.stringify({documentType:r.documentType,fileName:r.fileName}),ipAddress:e.headers.get("x-forwarded-for")||e.headers.get("x-real-ip"),userAgent:e.headers.get("user-agent")}}),i.NextResponse.json({success:!0})}catch(e){return console.error("Error deleting document:",e),i.NextResponse.json({error:e.message||"Erro ao deletar documento"},{status:500})}}let f=new s.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/documents/upload/route",pathname:"/api/documents/upload",filename:"route",bundlePath:"app/api/documents/upload/route"},resolvedPagePath:"C:\\Users\\andre\\OneDrive\\Documentos\\Netz\\Subscriptions\\NPCF Subs WEB\\app\\api\\documents\\upload\\route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:h,staticGenerationAsyncStorage:x,serverHooks:w}=f,y="/api/documents/upload/route";function v(){return(0,n.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:x})}},2663:(e,t,r)=>{r.d(t,{Z:()=>s});let o=require("@prisma/client"),s=global.prisma||new o.PrismaClient}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[789],()=>r(6762));module.exports=o})();